# CST Transformation

The older, now discontinued, CST transformation pipeline is briefly explained here. It's recommended that you use the AST pipeline as it's faster, easier to use and more capable.

- Construct transformations and transformation phases (called lifecycle users from now on) and combine them into a network of dependencies that do the transformation work.
- Register lifecycle users with a transformation manager.
- Every time a string is transformed by the transformation manager, or rather, the execution planner, the following happens:
  - The execution planner constructs an execution plan with the given fixed portion of the job parameters, if it can't be found in the cache. The plan is optimized for the minimum number of tree walk operations and dependencies deactivated based on the fixed parameters are not included.
  - It parses the string using the parser generated by ANTLR into a parse tree.
  - The execution planner runs the execution plan on the parse tree which transforms it in some way.
  - Finally, the transformation manager prints the transformed tree back into a string and returns it.

## Permitted CST Operations

- Adding a new parsed node anywhere (as a new local root)
- Removing any node with its entire subtree
- Replacing any node (remove, then add)
- Moving a local root node anywhere
- Moving a node strictly inside its local root scope (not a subscope)
- Removing or moving a non-local-root node without touching its subtree, though this may break things that rely on grammar rules being followed

## Not permitted (yet)

- Moving a node out of the scope of its local root (it would be missing a token stream)
- Entirely removing a local root node and replacing it with a new one, giving it the previous node's children

## Example

```java
// setup a transformer
var transformer = new CSTTransformer<>();

// register a transformation
manager.addConcurrent(transformation);

// after transformation
System.out.println(transformer.transform(input));
```
